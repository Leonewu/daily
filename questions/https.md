## 概要

- 使用了hash算法，对称加密和非对称加密
- hash 算法的应用

1. 对信息摘要进行 hash 散列

- 对称加密的应用

1. 客户端解密出服务端的公钥后，用公钥对某个随机生成的对称加密算法进行加密，发给服务端，后续通讯都使用该算法，因为非对称加密成本比对称加密高

- 非对称加密的应用

1. CA 用私钥（此私钥来自CA，不是网站的私钥）对【指纹算法和指纹（用指纹算法加密证书签发机构(也就是自己)、证书有效期、网站的公钥、网站域名等信息的文本文件）】进行加密，得到数字签名
2. 网站的公钥，服务端下发的证书中包含，客户端解密出该公钥后，用于后续通讯加密使用

### 概念

为什么老是记不住，因为流程比较多，每个步骤环环相扣，容易找不着北

- 原始信息：证书签发机构，有效期，网站公钥，网站域名等信息
- 数字证书：包含 明文原始信息，指纹，指纹算法，数字签名

### 处在哪一层

在 tcp 三次握手之后增加了 tls 四次握手

### 解决了http存在的问题

- `http`没有验证服务器身份
- `http`报文都是明文传输，没有经过加密
- 中间人篡改问题

### 与http的区别

- 端口区别
- http 是明文传输
- https 对搜索引擎更友好

### 流程

#### 网站证书签发过程

1. 网站生成密钥对，私钥自己保存，公钥和网站域名等信息提交给 CA 机构
2. CA 把原始信息（证书签发机构（也就是自己），证书有效期，网站公钥，网站域名等信息）以明文写入到文本文件
3. CA 选择一个指纹算法（一般为hash算法），计算原始信息得到指纹，用 CA 的私钥对指纹和指纹算法进行加密得到数字签名
4. CA 把明文证书，指纹，指纹算法，数字签名等信息打包到一起得到证书发给服务器
5. 此时服务器拥有了数字证书和自己的私钥

#### 握手过程

1. 客户端向服务端的443端口发起请求
2. 服务端发送证书给客户端，证书包含原始信息（哈希散列算法，公钥，个人信息，序列号，有效时间）和数字签名（用哈希散列算法加密原始信息，得到信息摘要，再用CA私钥加密信息摘要），支持的对称加密算法
3. 客户端先验证证书是否有效，域名是否和服务端的域名相同，证书的CA机构是否可靠（递归），然后用证书中的哈希散列算法计算证书中的原始信息，算出信息摘要，再用证书中的公钥解密数字签名，得到指纹和指纹算法，然后用指纹算法计算原始信息的指纹，与解密后的指纹对比，就可以看出是否有中间人篡改了。如果没问题，就生成随机的对称加密算法，用公钥加密后发送给服务端
4. 后续的报文传输都用上面的对称加密算法

## 参考

- [https的建立流程](https://segmentfault.com/a/1190000000476876)
- [https是如何保证安全的](https://juejin.im/post/5da04c1651882555704c868b)
- [深入理解https工作原理](https://github.com/ljianshu/Blog/issues/50)
