# tcp & udp

## tcp

1. tcp 是面向连接，全双工的协议，传输数据前需要建立连接，传输完之后要释放连接
2. 每一条 tcp 连接只能是点对点的（一对一），只能有两个端点
头部报文最少 20 字节，最大 60 字节，具有发送应答机制和超时重传机制
应用：

- HTTP，HTTPS
- SSH
- FTP
- SMTP，IMAP/POP

6 种 tcp 标志位：

- SYN(synchronous 建立联机)
- ACK(acknowledgement 确认)
- PSH(push 传送)
- FIN(finish 结束)
- RST(reset 重置)
- URG(urgent 紧急)  

2 个参数：

- Sequence number(顺序号码)
- Acknowledge number(确认号码)

### 三次握手

由于信道是不可靠的，请求报文可能会因为某些原因在网络节点滞留或者丢失，需要三次握手这种发送应答机制确认正常连接

1. 客户端生成随机数 x，发送 SYN 标志位，seq = x 到服务端
2. 服务端接收后，生成随机数 y，发送 SYN 和 ACK 标志位，seq = y，ack_num = x + 1 到客户端
3. 客户端接收后，发送 ACK 标志位，ack_num = y + 1 到服务端
4. 服务端建立连接

### 四次挥手

不管是客户端还是服务端，关闭连接都需要准备，当收到关闭连接的消息之后，另外一端准备完毕后才会关闭连接

1. 客户端生成随机数 x，发送 FIN 标志位，seq = x 到服务端
2. 服务端接收后，发送 ACK 标志位，ack_num = x + 1 到客户端，表示收到消息
3. 服务端准备好之后，生成随机数 y，发送 FIN 标志位，seq = y 到客户端
4. 客户端收到后，发送 ACK 标志位，ack_num = y + 1 到服务端，表示收到消息，可以关闭了
5. 服务端关闭连接

## udp

1. udp 是无连接的
2. udp 没有拥塞控制，因此网络出现拥塞不会使源主机的发送速率降低（对实时应用很有用，如直播，视频会议等）
3. udp 支持一对一，一对多，多对一和多对多的交互通信
4. udp 的首部开销小，只有 8 个字节，包括

- 两个十六位的端口号，分别为源端口（可选字段）和目标端口
- 整个数据报文的长度
- 整个数据报文的检验和（IPv4 可选 字段），该字段用于发现头部信息和数据中的错误
应用：DNS 域名系统  

## 区别

- tcp 是面向连接，全双工的，建立和断开连接需要双方的确认
- tcp 保证了可靠性和时序性，具有发送应答机制和超时重传机制
- udp 具有高效性，但容易丢包，不保证数据顺序
- tcp 头部最少 20 字节，udp 头部为 8 字节

## 思考

### tcp 怎么保证数据的可靠传输

1. 数据包校验：监测数据在传输过程中的任何变化，若校验出包有错，则丢弃报文段不响应，等待发送端重发数据
2. 丢弃重复数据
3. 应答机制：当 tcp 收到发自连接另一端的数据后，会发送一个确认。这个确认不是立即发送，通常推迟几分之一秒。
4. 超时重发：当 tcp 发出一个段之后，会启动一个定时器，等待目的端确认接收这个报文段。如果不能及时收到目的端的确认，就重发这个报文段
5. 流量控制：tcp 连接的每一方都有固定大小的缓冲空间。tcp 的接收端允许另一端发送接收端缓冲区能接纳的数据，这可以防止较快主机致使较慢主机的缓冲区移除，这就是流量控制。tcp 使用的流量控制协议是可变大小的滑动窗口协议。
6. 对失序数据包重新排序

### tcp 如何对数据包校验

### ip 和 tcp 的区别

ip 包括 tcp

### 分别描述一下 ip，tcp，udp 的首部

### 谈谈你对滑动窗口的了解

### 谈谈你对 tcp 拥塞控制的理解，使用了哪些算法？

### 讲述一下 DNS 解析的过程

## 参考

- [一文搞懂TCP与UDP的区别](https://www.cnblogs.com/fundebug/p/differences-of-tcp-and-udp.html)
- [计算机网络太难？了解这一篇就够了](https://zhuanlan.zhihu.com/p/84316213)
